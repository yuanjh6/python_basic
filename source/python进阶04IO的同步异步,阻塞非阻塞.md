# python进阶04IO的同步异步,阻塞非阻塞
## 同步和异步
同步和异步关注的是**消息通信机制**。

所谓同步，就是在发出一个**调用**时，在没有得到结果之前，该*调用*就不返回。但是一旦调用返回，就得到返回值了。
换句话说，就是由*调用者*主动等待这个*调用*的结果。

而异步则是相反，**调用**在发出之后，这个调用就直接返回了，所以没有返回结果。换句话说，当一个异步过程调用发出后，调用者不会立刻得到结果。而是在**调用**发出后，**被调用者**通过状态、通知来通知调用者，或通过回调函数处理这个调用。

举个通俗的例子：你打电话问书店老板有没有《分布式系统》这本书，如果是同步通信机制，书店老板会说，你稍等，”我查一下"，然后开始查啊查，等查好了（可能是5秒，也可能是一天）告诉你结果（返回结果）。而异步通信机制，书店老板直接告诉你我查一下啊，查好了打电话给你，然后直接挂电话了（不返回结果）。然后查好了，他会主动打电话给你。在这里老板通过“回电”这种方式来回调。

同步的整个流程就1部分,1问答，异步模式2部分，1问空答复+无问1答复。


## 阻塞和非阻塞
阻塞和非阻塞关注的是程序在**等待调用结果（消息，返回值）时的状态.**
阻塞调用是指调用结果返回之前，当前线程会被挂起。调用线程只有在得到结果之后才会返回。

非阻塞调用指在不能立刻得到结果之前，该调用不会阻塞当前线程。

你打电话问书店老板有没有《分布式系统》这本书，你如果是阻塞式调用，你会一直把自己“挂起”，直到得到这本书有没有的结果，如果是非阻塞式调用，你不管老板有没有告诉你，你自己先一边去玩了， 当然你也要偶尔过几分钟check一下老板有没有返回结果。在这里阻塞与非阻塞与是否同步异步无关。跟老板通过什么方式回答你结果无关。


还是上面的例子，你打电话问书店老板有没有《分布式系统》这本书，你如果是阻塞式调用，你会一直把自己“挂起”，直到得到这本书有没有的结果，如果是非阻塞式调用，你不管老板有没有告诉你，你自己先一边去玩了， 当然你也要偶尔过几分钟check一下老板有没有返回结果。在这里阻塞与非阻塞与是否同步异步无关。跟老板通过什么方式回答你结果无关。如果是关心阻塞 IO/ 异步 IO, 参考  Unix Network Programming View Book--还是2014年写的以解释概念为主，主要是同步异步 阻塞和非阻塞会被用在不同层面上，可能会有不准确的地方，并没有针对 阻塞 IO/ 异步 IO 等进行讨论，大家可以后续看看这两个回答：

作者：Yi Lu

链接：https://www.zhihu.com/question/19732473/answer/20851256


## 例子:老张水壶
老张爱喝茶，废话不说，煮开水。

出场人物：老张，水壶两把（普通水壶，简称水壶；会响的水壶，简称响水壶）。

1 老张把水壶放到火上，立等水开。（同步阻塞）

2 老张把水壶放到火上，去客厅看电视，时不时去厨房看看水开没有。（同步非阻塞）

老张还是觉得自己有点傻，于是变高端了，买了把会响笛的那种水壶。水开之后，能大声发出嘀~~~~的噪音。

3 老张把响水壶放到火上，立等水开。（异步阻塞）

4 老张把响水壶放到火上，去客厅看电视，水壶响之前不再去看它了，响了再去拿壶。（异步非阻塞）

所谓同步异步，只是对于水壶而言。

普通水壶，同步；响水壶，异步。虽然都能干活，但响水壶可以在自己完工之后，提示老张水开了。这是普通水壶所不能及的。同步只能让调用者去轮询自己（情况2中），造成老张效率的低下。

所谓阻塞非阻塞，仅仅对于老张而言。

立等的老张，阻塞；看电视的老张，非阻塞。情况1和情况3中老张就是阻塞的，媳妇喊他都不知道。虽然3中响水壶是异步的，可对于立等的老张没有太大的意义。所以一般异步是配合非阻塞使用的，这样才能发挥异步的效用。



作者：愚抄

链接：https://www.zhihu.com/question/19732473/answer/23434554


## 同步异步，阻塞非阻塞
二者其实是不同维度的东西，但是的确容易搞混，


|              你              |          客服          |       做法        |                   说明                    |
| --------------------------- | --------------------- | ---------------- | ---------------------------------------- |
|                             |                       | 做法A(同步，阻塞)   | 啥也不做，假装没听到他问话，电话不挂机，就呆呆放那 |
| 打电话：请问特朗普给我留言了么？   | 扫了一眼小本本，发现没留言 | 做法B(同步，非阻塞) | 告诉你，啥也没有(None)，然后挂掉电话           |
| 通话期间（手持话筒）你不能一心二用 |                       | 做法C(异步，非阻塞) | 告诉你，请留下电话，回头收到消息第一时间通知你    |
|                             |                       | 做法D(异步，阻塞)   | 没想到现实场景，理论上应该不存在     |

代码特征：

 做法A(同步，阻塞) :开单独线程（进程）处理，线程内一般是循环接收消息。

 做法B(同步，非阻塞) :主线程循环处理,但一般搭配sleep函数(释放时间片,自身状态运行转就绪再等待时间片)，避免完全的cpu空转

做法C(异步，非阻塞):函数参数包含函数(回调函数)，或url地址，类似的东西，对方有消息就推送给你，所以还需要新开一个接口(or功能)用来接受信息。

至于Ａ,B实例可参考本博客的 "django进阶系列02websocket" ，C实例就不多说了，js中非常常见。


## 参考
[怎样理解阻塞非阻塞与同步异步的区别](https://www.zhihu.com/question/19732473)

[NIO详解（二）： BIO 浅谈 同步 异步与阻塞 非阻塞](https://blog.csdn.net/qq_21125183/article/details/83831495)

[怎样理解同步异步和阻塞非阻塞](https://www.jianshu.com/p/9fa26b0b22a0)

